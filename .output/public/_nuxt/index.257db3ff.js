import{u as de}from"./vue.f36acd1f.ee4e5a38.js";import{_ as T,a as W,F as R,s as X,f as z}from"./Popup.vue.9460c2dc.js";import{u as A}from"./useData.cb5eebf3.js";import{f as K,o as x,c as j,a as I,g as U,u as e,d as Y,t as M,h as E,b as i,r as a,i as Z,F as J,w as N,j as L,k as P,l as me,m as fe,n as ve}from"./entry.676b6978.js";import se from"./icon-edit.257ea2b2.js";import G from"./icon-trash.903a0f0f.js";import ue from"./icon-checkbox.fea6b3a6.js";import ie from"./icon-square.45dde8bf.js";import he from"./icon-user-plus.96f2d2a7.js";import{P as ee}from"./PopupContainer.54ccd51c.js";import{s as _e}from"./slugify.7011283c.js";import{C as re,a as ce}from"./company.44139364.js";import te from"./icon-plus.4a836dcb.js";import{u as pe}from"./useAuth.ec594533.js";import{_ as ye}from"./PhotosList.vue.f540a820.js";import"./nuxt-link.6c446591.js";import"./icon-close.c49ccc36.js";import"./cookie.5691c368.js";import"./ssr.02200a8e.js";import"./nuxt-img.ced04cb3.js";import"./icon-restore.f3d8e6a1.js";const ge={class:"flex items-center px-4 py-3 bg-dark-light/10 odd:bg-white hover:bg-dark-light/20 cursor-pointer rounded"},xe={class:"flex items-center w-6/12"},ke={class:"w-4/12"},be={class:"w-2/12 flex items-center justify-end"},we=["onClick"],Ve=["onClick"],Ce=K({__name:"NewsListItem",props:{item:Object},emits:["click","delete"],setup(C,{emit:y}){const c=C,l=y,m=()=>{l("click",c.item)},t=()=>{var s;confirm(`Вы действительно хотите удалить новость «${(s=c.item)==null?void 0:s.name}»`)&&l("delete",c.item)};return(s,u)=>(x(),j("div",ge,[I("div",xe,[C.item.active?(x(),U(e(ue),{key:0,class:"w-5 h-5 mr-1",filled:""})):(x(),U(e(ie),{key:1,class:"w-5 h-5 mr-1",filled:""})),Y(" "+M(C.item.title),1)]),I("div",ke,"/news/"+M(C.item.slug),1),I("div",be,[I("a",{href:"",class:"block w-5 h-5 mx-1 text-dark-main hover:text-main",onClick:E(m,["prevent"])},[i(e(se),{filled:""})],8,we),I("a",{href:"",class:"block w-5 h-5 mx-1 text-dark-main hover:text-main",onClick:E(t,["prevent"])},[i(e(G),{filled:""})],8,Ve)])]))}}),$e=K({__name:"NewsList",emits:["click","delete"],setup(C,{expose:y,emit:c}){const l=A(),m=a(l.news),t=c,s=V=>{t("click",V)},u=V=>{t("delete",V)};return y({update:()=>{m.value=l.news}}),(V,d)=>(x(!0),j(J,null,Z(e(m),v=>(x(),U(Ce,{item:v,key:v.id,onClick:s,onDelete:u},null,8,["item"]))),128))}}),Se={class:"w-12/12 min-w-[300px]"},Fe={class:"w-full text-center"},Le=I("span",{class:"hidden md:inline"},"Добавление новости",-1),Ie=K({__name:"News",setup(C){const y=a("Добавить новость"),c=a(),l=a(""),m=a(""),t=a(""),s=a(""),u=a(!1),w=a(void 0),V=A(),d=a(),v=o=>{y.value="Добавить новость",o!=null&&o.id&&(y.value="Изменение новости",l.value=(o==null?void 0:o.title)||"",m.value=(o==null?void 0:o.slug)||"",t.value=(o==null?void 0:o.text)||"",s.value=(o==null?void 0:o.date.toString())||"",u.value=(o==null?void 0:o.active)||!1,w.value=(o==null?void 0:o.id)||void 0),c.value.show()},p=()=>{c.value.hide(),l.value="",m.value="",t.value="",s.value="",u.value=!1,w.value=void 0},b=async()=>{V.updateNews({id:w.value||void 0,title:l.value,slug:m.value,active:u.value,text:t.value||null,date:new Date(s.value)}).then(o=>{if(o){if(o!=null&&o.errors)return X("news_form",[],o.errors);d.value.update(),p()}}).catch(o=>{console.log(o)})},g=async o=>{await V.deleteNews(o).then(()=>d.value.update())},k=()=>{m.value=_e(l.value,50)};return(o,f)=>{const F=z;return x(),U(e(R),{"config-file":"true"},{default:N(()=>[I("div",Se,[I("div",Fe,[i(T,{class:"inline-flex items-center bg-main text-white hover:bg-main-light py-3 px-6 w-auto mx-auto mb-8",title:"Добавить новость",onClick:v},{default:N(()=>[i(e(he),{class:"block text-white w-6 h-6 mr-2",filled:""}),Le]),_:1})]),i($e,{onClick:v,onDelete:g,ref_key:"newsList",ref:d},null,512),i(ee,{ref_key:"popup",ref:c,onClose:p},{default:N(()=>[i(W,{class:"bg-gray-light/60 w-full min-w-[300px] max-w-[800px] max-h-full pb-0",title:e(y),onClose:p},{default:N(()=>[i(F,{id:"news_form",type:"form","submit-label":e(w)?"Сохранить":"Добавить",config:{validationVisibility:"submit"},onSubmit:b},{default:N(()=>[i(F,{type:"text",name:"name",id:"name",label:"Заголовок",placeholder:"Заголовок новости",modelValue:e(l),"onUpdate:modelValue":f[0]||(f[0]=O=>L(l)?l.value=O:null),onKeyup:k,validation:"required|length:8","validation-visibility":"live","validation-messages":{news_exists:"Новость с данным заголовком уже существует",length:"Длина заголовка должна быть не менее 8 символов",required:"Необходимо указать заголовок новости",name:"Наименование должно состоять из букв и пробелов"}},null,8,["modelValue"]),i(F,{type:"text",name:"slug",id:"slug",label:"Идентификатор",placeholder:"name_url_slug",modelValue:e(m),"onUpdate:modelValue":f[1]||(f[1]=O=>L(m)?m.value=O:null),validation:"required|length:3|matches:/[0-9a-z_]/","validation-visibility":"live","validation-messages":{length:"Длина Идентификатора должна быть не менее 5 символов",required:"Необходимо указать Идентификатор",matches:"В написании Идентификатора допустимо использование символов английского алфавита и нижнего подчеркивания"}},null,8,["modelValue"]),i(F,{type:"textarea",name:"text",id:"text",label:"Текст",placeholder:"Текст новости",modelValue:e(t),"onUpdate:modelValue":f[2]||(f[2]=O=>L(t)?t.value=O:null),validation:"required|length:15","validation-visibility":"live","validation-messages":{length:"Длина текста новости должна быть не менее 15 символов",required:"Необходимо указать текст новости"}},null,8,["modelValue"]),i(F,{type:"date",label:"Дата",modelValue:e(s),"onUpdate:modelValue":f[3]||(f[3]=O=>L(s)?s.value=O:null),validation:"required|date_after:2023-10-01","validation-visibility":"live","validation-messages":{required:"Необходимо указать дату выхода новости",date_after:"Дата должна быть не раньше 01 октября 2023"}},null,8,["modelValue"]),i(F,{type:"checkbox",name:"isActive",id:"isActive",label:"Отображение новости на сайте",modelValue:e(u),"onUpdate:modelValue":f[4]||(f[4]=O=>L(u)?u.value=O:null)},null,8,["modelValue"])]),_:1},8,["submit-label"])]),_:1},8,["title"])]),_:1},512)])]),_:1})}}}),Ue={class:"flex gap-2"},Ne={class:"grow"},Oe={class:"flex items-stretch"},qe=K({__name:"ContactsListItem",props:{item:Object,options:Array,index:Number,indexLast:Boolean},emits:["add","delete","update"],setup(C,{emit:y}){var b;const c=C,l=y,m=c.item,t=a(m.type),s=a(re[m.type]),u=a(m.value);(b=c.options)==null||b.forEach(g=>{t.value===g.value&&(g.attr.default=!0)});function w(){const g=V(t.value);g&&(s.value=g),u.value="",p()}function V(g){return Object.keys(ce).find(k=>k===g)}function d(){l("add",c.item)}function v(){l("delete",c.index)}function p(){let g=e(u);if(!g)return;const k={type:t.value,value:g};l("update",k,c.index)}return(g,k)=>{const o=z;return x(),U(e(R),{"config-file":"true"},{default:N(()=>[I("div",Ue,[I("div",null,[i(o,{type:"select",options:C.options,modelValue:e(t),"onUpdate:modelValue":k[0]||(k[0]=f=>L(t)?t.value=f:null),default:e(t),onChange:w},null,8,["options","modelValue","default"])]),I("div",Ne,[e(s)==="phone"?(x(),U(o,{key:0,type:"mask",name:"phone",mask:"+7 (###) ###-##-##",modelValue:e(u),"onUpdate:modelValue":k[1]||(k[1]=f=>L(u)?u.value=f:null),autocomplete:"off",onKeyup:p},null,8,["modelValue"])):P("",!0),e(s)==="email"?(x(),U(o,{key:1,type:"email",name:"email",placeholder:"your@email.ru",modelValue:e(u),"onUpdate:modelValue":k[2]||(k[2]=f=>L(u)?u.value=f:null),autocomplete:"off",onKeyup:p},null,8,["modelValue"])):P("",!0),e(s)==="vk"?(x(),U(o,{key:2,type:"mask",name:"vk",mask:"vk.com/##########",modelValue:e(u),"onUpdate:modelValue":k[3]||(k[3]=f=>L(u)?u.value=f:null),autocomplete:"off",onKeyup:p},null,8,["modelValue"])):P("",!0),e(s)==="instagram"?(x(),U(o,{key:3,type:"mask",name:"instagram",mask:"instagram.com/##########",modelValue:e(u),"onUpdate:modelValue":k[4]||(k[4]=f=>L(u)?u.value=f:null),autocomplete:"off",onKeyup:p},null,8,["modelValue"])):P("",!0),e(s)==="ok"?(x(),U(o,{key:4,type:"mask",name:"ok",mask:"ok.ru/##########",modelValue:e(u),"onUpdate:modelValue":k[5]||(k[5]=f=>L(u)?u.value=f:null),autocomplete:"off",onKeyup:p},null,8,["modelValue"])):P("",!0)]),I("div",Oe,[C.indexLast?(x(),U(T,{key:0,class:"inline-flex items-center bg-second text-white hover:bg-main-light py-2 px-6",onClick:E(d,["prevent"])},{default:N(()=>[i(e(te),{filled:"",class:"w-5 h-5"})]),_:1},8,["onClick"])):(x(),U(T,{key:1,class:"inline-flex items-center bg-gray-light text-white hover:bg-red-600 py-2 px-6",onClick:E(v,["prevent"])},{default:N(()=>[i(e(G),{filled:"",class:"w-5 h-5"})]),_:1},8,["onClick"]))])])]),_:1})}}}),De=K({__name:"ContactsList",props:{contacts:Object},setup(C,{expose:y}){const c=C;y({getContacts:d,update:v});const l=a([]);typeof c.contacts<"u"&&v(c.contacts);const m=me(()=>l.value.length-1),t=Object(ce),s=a([]);for(const p in t)s.value.push({label:t[p],value:p,attr:{default:!1}});function u(){l.value.push({id:0,type:re.phone,value:""})}function w(p){l.value[p].isDeleted=!0}function V(p,b){l.value[b]=p}function d(){return l.value.filter(p=>p.value.trim()!=="")}function v(p){if(l.value=[],!p){u();return}p.forEach(b=>{l.value.push({id:b.id,type:b.type,value:b.value,isDeleted:b.isDeleted})})}return(p,b)=>(x(!0),j(J,null,Z(e(l),(g,k)=>(x(),j("div",{key:`contacts_${g==null?void 0:g.id}`,class:"formkit-no-limits"},[g.isDeleted?P("",!0):(x(),U(qe,{key:0,item:g,index:k,indexLast:k===e(m),options:e(s),onAdd:u,onDelete:w,onUpdate:V},null,8,["item","index","indexLast","options"]))]))),128))}});const je={class:"max-w-[600px] formkit-w-full"},ne=K({__name:"CompaniesForm",props:{data:{type:Object,default:void 0}},emits:["save","delete"],setup(C,{expose:y,emit:c}){const l=C,m=c;y({setup:f});let t=l.data;const s=A(),u=pe(),w=a(),V=a([]);s.ownership&&s.ownership.forEach(h=>{V.value.push(`${h.nameShort} (${h.nameFull})`)});const d=a((t==null?void 0:t.id)||0),v=a((t==null?void 0:t.nameShort)||""),p=a((t==null?void 0:t.nameFull)||""),b=a((t==null?void 0:t.requsites)||""),g=a(t!=null&&t.ownership?`${t.ownership.nameShort} (${t.ownership.nameFull})`:""),k=a();let o=!1;function f(h){h&&(t=h),v.value=(h==null?void 0:h.nameShort)||"",p.value=(h==null?void 0:h.nameFull)||"",b.value=(h==null?void 0:h.requsites)||"",g.value=h!=null&&h.ownership?`${h.ownership.nameShort} (${h.ownership.nameFull})`:"",d.value=(h==null?void 0:h.id)||0,o=!!(h!=null&&h.nameShort),w.value=h==null?void 0:h.contacts,k.value.update(h==null?void 0:h.contacts)}const F=()=>{var q,n,r;console.log("submit");const h=k.value.getContacts();if(typeof t>"u"&&(t={nameFull:"",nameShort:"",user:{id:(q=u.user)==null?void 0:q.id,email:((n=u.user)==null?void 0:n.email)||"",fio:(r=u.user)==null?void 0:r.fio}}),t.id=d.value,t.nameFull=p.value,t.nameShort=v.value,t.requsites=b.value,s.ownership){g.value=g.value||s.ownership[0];const _=s.ownership.findIndex($=>`${$.nameShort} (${$.nameFull})`===g.value);t.ownership=s.ownership[_>=0?_:0]}t.contacts=h,s.updateCompany(t).then(_=>{var $,D;if(_){if(_!=null&&_.errors)return X("companies_form",($=_.errors)!=null&&$.other?[(D=_.errors)==null?void 0:D.other]:[],_.errors);m("save")}}).catch(_=>{console.log(_)})},O=()=>{o||(v.value=p.value.trim())},B=()=>{o=p.value.trim()!==v.value.trim()},Q=()=>{confirm(`Вы действительно хотите удалить компанию «${p.value}»`)&&m("delete",t)};return(h,q)=>{const n=z;return x(),U(e(R),{"config-file":"true"},{default:N(()=>[I("div",je,[i(n,{id:"companies_form",type:"form","submit-label":e(d)?"Сохранить":"Добавить",config:{validationVisibility:"submit"},onSubmit:F},{default:N(()=>[i(n,{type:"select",label:"Форма собственности",name:"ownership",options:e(V),modelValue:e(g),"onUpdate:modelValue":q[0]||(q[0]=r=>L(g)?g.value=r:null)},null,8,["options","modelValue"]),i(n,{type:"text",name:"nameFull",id:"name_full",label:"Полное название",placeholder:"Юридическое название компании",modelValue:e(p),"onUpdate:modelValue":q[1]||(q[1]=r=>L(p)?p.value=r:null),onKeyup:O,validation:"required|length:3|contains_alpha_spaces","validation-messages":{company_exists:"Указанная компания уже существует",length:"Длина наименование должна быть не менее 3 символов",required:"Необходимо указать юридическое наименование компании",name:"Наименование должно состоять из букв и пробелов"}},null,8,["modelValue"]),i(n,{type:"text",name:"nameShort",id:"name_short",label:"«Публичное» название",placeholder:"«Публичное» название компании",modelValue:e(v),"onUpdate:modelValue":q[2]||(q[2]=r=>L(v)?v.value=r:null),onKeyup:B,validation:"required|length:3|contains_alpha_spaces","validation-messages":{company_exists:"Указанная компания уже существует",length:"Длина наименование должна быть не менее 3 символов",required:"Необходимо указать «публичное» наименование компании",name:"Наименование должно состоять из букв и пробелов"}},null,8,["modelValue"]),i(n,{type:"textarea",name:"requisite",id:"requisite",label:"Реквизиты",placeholder:"Банковские реквизиты",modelValue:e(b),"onUpdate:modelValue":q[3]||(q[3]=r=>L(b)?b.value=r:null)},null,8,["modelValue"]),i(De,{contacts:e(w),ref_key:"contacts",ref:k},null,8,["contacts"])]),_:1},8,["submit-label"]),e(s).companies.length>1&&e(d)?(x(),U(T,{key:0,class:"flex items-center justify-center bg-gray-light text-white hover:bg-red-600 py-3 px-6 mt-6 text-center",onClick:E(Q,["prevent"])},{default:N(()=>[i(e(G),{filled:"",class:"w-5 h-5"}),Y(" Удалить компанию ")]),_:1},8,["onClick"])):P("",!0)])]),_:1})}}});const Ke=["onClick"],Ee={class:"w-1/12"},Pe={class:"w-6/12"},Te={class:"w-2/12"},Ae={class:"w-2/12"},Be={class:"flex w-1/12 justify-end"},Me=["onClick"],Re=K({__name:"InitiativeListItem",props:{item:Object,index:Number},emits:["onClick","onDelete"],setup(C,{emit:y}){const c=C,l=c.item,m=a(["Отдых","Бизнес"]),t=y;function s(){t("onClick",e(l),c.index)}function u(){confirm(`Вы действительно хотите удалить инициативу «${l.name}»?`)&&t("onDelete",e(l),c.index)}return(w,V)=>{var d;return x(),j("div",{class:"flex items-center px-4 py-3 bg-dark-light/10 odd:bg-white hover:bg-dark-light/20 cursor-pointer round",onClick:E(s,["prevent","stop"])},[I("div",Ee,[(d=c.item)!=null&&d.status?(x(),U(e(ue),{key:0,class:"w-5 h-5 mr-1",filled:""})):(x(),U(e(ie),{key:1,class:"w-хъ h-5 mr-1",filled:""}))]),I("div",Pe,M(c.item.name),1),I("div",Te,M(e(m)[c.item.direction]),1),I("div",Ae,M(c.item.region.name),1),I("div",Be,[I("a",{href:"",class:"block w-5 h-5 mx-1 text-dark-main hover:text-main",onClick:E(u,["prevent","stop"])},[i(e(G),{filled:""})],8,Me)])],8,Ke)}}}),ze={class:"my-4"},He=K({__name:"InitiativeList",emits:["onClick","onDelete"],setup(C,{expose:y,emit:c}){const l=A(),m=a(l.initiatives);y({refresh:s,update:u});const t=c;function s(){m.value=l.initiatives}function u(d,v){m.value[v]&&(m.value[v]=d)}function w(d,v){s(),t("onClick",m.value[v],v)}function V(d,v){t("onDelete",d,v)}return(d,v)=>(x(),j("div",ze,[(x(!0),j(J,null,Z(e(m),(p,b)=>(x(),U(Re,{key:`init${p.id}`,item:p,index:b,onOnClick:w,onOnDelete:V},null,8,["item","index"]))),128))]))}}),ae=K({__name:"InitiativeForm",props:{company:Object},emits:["save"],setup(C,{expose:y,emit:c}){const l=A();pe();const m=C;y({setup:h});const t=c,s=a(0),u=a(""),w=a(""),V=a(""),d=a(!1),v=a([]),p=a([]),b=a([]),g=a([]),k=a(0),o=a(0),f=a(0),F=a(),O=l.regions,B=l.types,Q=[{label:"Отдых",value:0},{label:"Бизнес",value:1}];h();function h(n){s.value=(n==null?void 0:n.id)||0,u.value=(n==null?void 0:n.name)||"",w.value=(n==null?void 0:n.text)||"",v.value=(n==null?void 0:n.photos)||[],d.value=(n==null?void 0:n.status)||!1,V.value="",O&&(b.value=[],O.forEach(r=>{const _={label:r.name,value:r.id||0};n&&(n==null?void 0:n.region.id)===r.id&&(o.value=r.id||0,_.attr={default:!0}),b.value.push(_)}),o.value||(o.value=O[0].id||0)),B&&(g.value=[],B.forEach(r=>{const _={label:r.name,value:r.id||0};n&&(n==null?void 0:n.type.id)===r.id&&(f.value=r.id||0,_.attr={default:!0}),g.value.push(_)}),f.value||(f.value=B[0].id||0)),p.value=[],Q.forEach(r=>{const _={label:r.label,value:r.value};n&&(n==null?void 0:n.direction)===r.value&&(_.attr={default:!0},k.value=r.value||0),p.value.push(_)}),F.value&&F.value.update((n==null?void 0:n.photos)||[])}const q=n=>{var le;const r=b.value.find(S=>S.value.toString()===(o.value||n.region)),_=g.value.find(S=>S.value.toString()===(f.value||n.type)),$=m.company;let D;if(n.photos.length){D=new FormData;for(const S in n)if(S==="photos")n[S].length&&((le=n[S])==null||le.forEach(H=>{D.append("photos",H.file)}));else switch(S){case"region":{D.append(S,(o.value||(r==null?void 0:r.value)||n[S]).toString());break}case"type":{D.append(S,((_==null?void 0:_.value)||n[S]).toString());break}default:D.append(S,n[S])}D.append("company",(($==null?void 0:$.id)||0).toString()),D.append("id",s.value.toString()),D.append("photosList",v.value.length?JSON.stringify(v.value):"")}else D={id:s.value.toString(),status:n.status.toString(),direction:n.direction.toString(),region:((r==null?void 0:r.value)||n.region).toString(),type:((_==null?void 0:_.value)||n.type).toString(),company:(($==null?void 0:$.id)||0).toString(),photos:e(v),name:n.name.toString(),text:n.text.toString()};l.updateInitiative(D).then(S=>{var H,oe;if(S){if(S!=null&&S.errors)return X("initiative_form",(H=S.errors)!=null&&H.other?[(oe=S.errors)==null?void 0:oe.other]:[],S.errors);t("save")}}).catch(S=>{console.log(S)})};return(n,r)=>{const _=z;return x(),U(e(R),{"config-file":"true"},{default:N(()=>[I("div",{class:"max-w-[600px] formkit-w-full",onClick:r[7]||(r[7]=E(()=>{},["stop"]))},[i(_,{id:"initiative_form",type:"form","submit-label":e(s)?"Сохранить":"Добавить",config:{validationVisibility:"submit"},onSubmit:q},{default:N(()=>[i(_,{type:"checkbox",name:"status",id:"status",label:"Отображение на сайте",modelValue:e(d),"onUpdate:modelValue":r[0]||(r[0]=$=>L(d)?d.value=$:null)},null,8,["modelValue"]),i(_,{type:"select",name:"direction",id:"direction",label:"Направление",modelValue:e(k),"onUpdate:modelValue":r[1]||(r[1]=$=>L(k)?k.value=$:null),options:e(p)},null,8,["modelValue","options"]),i(_,{type:"select",name:"type",id:"type",label:"Тип инициативы",modelValue:e(f),"onUpdate:modelValue":r[2]||(r[2]=$=>L(f)?f.value=$:null),options:e(g)},null,8,["modelValue","options"]),i(_,{type:"select",name:"region",id:"region",label:"Регион",modelValue:e(o),"onUpdate:modelValue":r[3]||(r[3]=$=>L(o)?o.value=$:null),options:e(b)},null,8,["modelValue","options"]),i(_,{type:"text",name:"name",id:"name",label:"Наименование",placeholder:"Наименование инициативы",modelValue:e(u),"onUpdate:modelValue":r[4]||(r[4]=$=>L(u)?u.value=$:null),validation:"required|length:3|contains_alpha_spaces","validation-messages":{initiative_exists:"Указанная компания уже существует",length:"Длина наименование должна быть не менее 3 символов",required:"Необходимо указать юридическое наименование компании",name:"Наименование должно состоять из букв и пробелов"}},null,8,["modelValue"]),i(_,{type:"textarea",name:"text",id:"text",label:"Текст",placeholder:"Введите текст инициативы",modelValue:e(w),"onUpdate:modelValue":r[5]||(r[5]=$=>L(w)?w.value=$:null)},null,8,["modelValue"]),i(_,{type:"file",name:"photos",label:"Фотографии",accept:".jpg,.gif,.png,.jpeg,.webp,.svg",multiple:"true",modelValue:e(V),"onUpdate:modelValue":r[6]||(r[6]=$=>L(V)?V.value=$:null)},null,8,["modelValue"]),i(ye,{photos:e(v),ref_key:"photosList",ref:F},null,8,["photos"])]),_:1},8,["submit-label"])])]),_:1})}}}),Je=I("h2",{class:"mt-8 mb-4 text-xl"},"Инициативы",-1),Ge={key:1},Qe=K({__name:"Initiatives",props:{company:Object},setup(C){const y=A(),c=a(y.initiatives),l=a("Добавить инициативу"),m=a(),t=a(),s=a(),u=d=>{l.value="Добавить инициативу",m.value.show(),d instanceof Event?t.value.setup():(d!=null&&d.id&&(l.value="Изменить инициативу"),t.value.setup(d))},w=()=>{m.value&&m.value.hide(),l.value="",c.value=(y==null?void 0:y.initiatives)||[]};fe(c,d=>{d.length>0&&s.value&&s.value.refresh()});const V=(d,v)=>{y.deleteInitiative(d).then(()=>{c.value=(y==null?void 0:y.initiatives)||[]}).catch(p=>{console.log(p)})};return(d,v)=>(x(),j(J,null,[Je,e(c).length?(x(),j("div",Ge,[i(T,{class:"inline-flex items-center bg-second text-white hover:bg-main-light py-2 px-6",title:"Добавить инициативу",onClick:u},{default:N(()=>[i(e(te),{filled:"",class:"w-6 h-6"}),Y(" Добавить инициативу ")]),_:1}),i(He,{ref_key:"initiativeList",ref:s,onOnClick:u,onOnDelete:V},null,512),i(ee,{ref_key:"popup",ref:m,onClose:w},{default:N(()=>[i(W,{class:"bg-gray-light/60 w-full max-h-full min-w-[300px] max-w-[600px] pb-0",title:e(l),onClose:w},{default:N(()=>[i(ae,{company:C.company,ref_key:"initiativeForm",ref:t,onSave:w},null,8,["company"])]),_:1},8,["title"])]),_:1},512)])):(x(),U(ae,{key:0,company:C.company,ref_key:"initiativeForm",ref:t,onSave:w},null,8,["company"]))],64))}}),We={key:1},Xe={class:"formkit-no-limits flex gap-2 items-end max-w-[600px]"},Ye={class:"grow"},Ze=K({__name:"Companies",setup(C){var k;const y=a("Добавить компанию"),c=a(),l=A(),m=a(l.companies||[]),t=a([]),s=a(l.companies?(k=l.companies[0])==null?void 0:k.id:0),u=a(l.companies?l.companies[0]:void 0),w=a(),V=a(),d=()=>{var o,f;(o=l==null?void 0:l.companies)!=null&&o.length?(t.value=[],l==null||l.companies.forEach(F=>{t.value.push({label:F.nameShort!==F.nameFull?`${F.nameShort} (${F.nameFull})`:F.nameFull,value:F.id||0})}),m.value=l==null?void 0:l.companies):(f=V.value)==null||f.setup()},v=()=>{if(!(l!=null&&l.companies))return;const o=s.value||0,f=l==null?void 0:l.companies.find(F=>F.id===o);f&&p(f)},p=o=>{y.value="Добавить компанию",u.value=void 0,o!=null&&o.id&&(y.value="Изменение компании",u.value=o),w.value.setup(o),c.value.show()},b=()=>{c.value.hide(),y.value="",l!=null&&l.companies&&d()},g=async o=>{await l.deleteCompany(o).then(()=>{b(),d()})};return ve(()=>{d()}),(o,f)=>{const F=z;return x(),U(e(R),{"config-file":"true"},{default:N(()=>[e(m).length?(x(),j("div",We,[I("div",Xe,[I("div",Ye,[i(F,{type:"select",name:"companies",modelValue:e(s),"onUpdate:modelValue":f[0]||(f[0]=O=>L(s)?s.value=O:null),label:e(m).length===1?"Компания":"Компании",options:e(t)},null,8,["modelValue","label","options"])]),i(T,{class:"inline-flex items-center bg-main text-white hover:bg-main-light py-2 px-6",title:"Редактировать",onClick:v},{default:N(()=>[i(e(se),{filled:"",class:"w-6 h-6"})]),_:1}),i(T,{class:"inline-flex items-center bg-second text-white hover:bg-main-light py-2 px-6",title:"Добавить компанию",onClick:p},{default:N(()=>[i(e(te),{filled:"",class:"w-6 h-6"})]),_:1})]),i(Qe,{company:e(u)},null,8,["company"]),i(ee,{ref_key:"popup",ref:c,onOnClose:b},{default:N(()=>[i(W,{class:"bg-gray-light/60 w-full max-h-full min-w-[300px] max-w-[600px] pb-0",title:e(y),onClose:b},{default:N(()=>[i(ne,{ref_key:"companyForm",ref:w,onSave:b,onDelete:g},null,512)]),_:1},8,["title"])]),_:1},512)])):(x(),U(ne,{key:0,ref_key:"companyFormStart",ref:V,onSave:d},null,512))]),_:1})}}}),et={key:0},tt={key:1},wt=K({__name:"index",props:{data:Object},setup(C){var c;return de({title:(c=C.data)!=null&&c.news?"АГА. Список новостей":"Список компаний / инициатив"}),(l,m)=>{var t;return(t=C.data)!=null&&t.news?(x(),j("div",et,[i(Ie)])):(x(),j("div",tt,[i(Ze)]))}}});export{wt as default};
