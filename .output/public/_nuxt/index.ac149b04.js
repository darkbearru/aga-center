import{u as L}from"./vue.f36acd1f.ee4e5a38.js";import{_ as D,a as F,F as P,s as q,f as B}from"./Popup.vue.9460c2dc.js";import{u as I}from"./useData.cb5eebf3.js";import{f as V,o as h,c as E,a as v,d as N,t as C,g as w,u as t,k as U,h as $,b as o,r as c,i as j,F as S,w as g,j as y}from"./entry.676b6978.js";import K from"./icon-edit.257ea2b2.js";import O from"./icon-trash.903a0f0f.js";import T from"./icon-user-cog.0113b303.js";import z from"./icon-user-check.a0453db3.js";import H from"./icon-user-plus.96f2d2a7.js";import{P as R}from"./PopupContainer.54ccd51c.js";import"./nuxt-link.6c446591.js";import"./icon-close.c49ccc36.js";import"./cookie.5691c368.js";const G={class:"flex items-center px-4 py-3 bg-dark-light/10 odd:bg-white hover:bg-dark-light/20 cursor-pointer rounded"},J={class:"flex items-center w-6/12"},Q={class:"w-4/12"},W={class:"w-2/12 flex items-center justify-end"},X=["onClick"],Y=["onClick"],Z=V({__name:"UsersListItem",props:{item:Object},emits:["click","delete"],setup(m,{emit:p}){const s=m,a=p,i=()=>{a("click",s.item)},n=()=>{var l,d;confirm(`Вы действительно хотите удалить пользователя «${(l=s.item)==null?void 0:l.fio} (${(d=s.item)==null?void 0:d.email})»`)&&a("delete",s.item)};return(l,d)=>{var x,r,k,u;return h(),E("div",G,[v("div",J,[N(C((x=m.item)==null?void 0:x.fio)+" ",1),(r=m.item)!=null&&r.isAdmin?(h(),w(t(T),{key:0,class:"w-5 h-5 ml-1 text-second",filled:""})):U("",!0),(k=m.item)!=null&&k.isModerator?(h(),w(t(z),{key:1,class:"w-5 h-5 ml-1 text-second",filled:""})):U("",!0)]),v("div",Q,C((u=m.item)==null?void 0:u.email),1),v("div",W,[v("a",{href:"",class:"block w-5 h-5 mx-1 text-dark-main hover:text-main",onClick:$(i,["prevent"])},[o(t(K),{filled:""})],8,X),v("a",{href:"",class:"block w-5 h-5 mx-1 text-dark-main hover:text-main",onClick:$(n,["prevent"])},[o(t(O),{filled:""})],8,Y)])])}}}),ee=V({__name:"UsersList",emits:["click","delete"],setup(m,{expose:p,emit:s}){const a=I(),i=c(a.users),n=s,l=r=>{n("click",r)},d=r=>{n("delete",r)};return p({update:()=>{i.value=a.users}}),(r,k)=>(h(!0),E(S,null,j(t(i),u=>(h(),w(Z,{item:u,key:u.id,onClick:l,onDelete:d},null,8,["item"]))),128))}}),te={class:"w-7/12 min-w-[520px]"},ae={class:"w-full text-center"},le=v("span",{class:"hidden md:inline"},"Добавление пользователя",-1),oe=V({__name:"Users",setup(m){const p=c("Добавить пользователя"),s=c(),a=c(""),i=c(""),n=c(!1),l=c(!1),d=c(void 0),x=I(),r=c(),k=e=>{p.value="Добавить пользователя",e!=null&&e.id&&(p.value="Изменение данных пользователя",a.value=(e==null?void 0:e.email)||"",i.value=(e==null?void 0:e.fio)||"",n.value=(e==null?void 0:e.isAdmin)||!1,l.value=(e==null?void 0:e.isModerator)||!1,d.value=(e==null?void 0:e.id)||void 0),s.value.show()},u=()=>{s.value.hide(),a.value="",i.value="",n.value=!1,l.value=!1,d.value=void 0},M=async()=>{x.updateUser({id:d.value||void 0,email:a.value,fio:i.value,isModerator:l.value,isAdmin:n.value}).then(e=>{if(e){if(e!=null&&e.errors)return q("users_form",[],e.errors);r.value.update(),u()}}).catch(e=>{console.log(e)})},A=async e=>{await x.deleteUser(e).then(()=>r.value.update())};return(e,f)=>{const b=B;return h(),w(t(P),{"config-file":"true"},{default:g(()=>[v("div",te,[v("div",ae,[o(D,{class:"inline-flex items-center bg-main text-white hover:bg-main-light py-3 px-6 w-auto mx-auto mb-8",title:"Добавление пользователя",onClick:k},{default:g(()=>[o(t(H),{class:"block text-white w-6 h-6 mr-2",filled:""}),le]),_:1})]),o(ee,{onClick:k,onDelete:A,ref_key:"usersList",ref:r},null,512),o(R,{ref_key:"popup",ref:s,onClose:u},{default:g(()=>[o(F,{class:"bg-gray-light/60 w-full min-w-[300px] max-w-[500px] max-h-full pb-0",title:t(p),onClose:u},{default:g(()=>[o(b,{id:"users_form",type:"form","submit-label":t(d)?"Сохранить":"Добавить",config:{validationVisibility:"submit"},onSubmit:M},{default:g(()=>[o(b,{type:"email",name:"email",id:"email",label:"E-mail",placeholder:"your@email.com",modelValue:t(a),"onUpdate:modelValue":f[0]||(f[0]=_=>y(a)?a.value=_:null),validation:"required|length:5|email","validation-visibility":"live","validation-messages":{email_exists:"Указанный email уже занят, попробуйте указать другой",length:"Длина Email должна быть не менее 5 символов",required:"Необходимо указать Email",email:"Email должен соответствовать формату «aaa@domain.name»"}},null,8,["modelValue","validation-messages"]),o(b,{type:"text",name:"fio",id:"fio",label:"ФИО",placeholder:"ФИО",modelValue:t(i),"onUpdate:modelValue":f[1]||(f[1]=_=>y(i)?i.value=_:null),validation:"required|length:5|contains_alpha_spaces","validation-visibility":"live","validation-messages":{length:"Длина ФИО должна быть не менее 5 символов",required:"Необходимо указать ФИО",contains_alpha_spaces:"ФИО может состоять только из букв и пробелов"}},null,8,["modelValue"]),o(b,{type:"checkbox",name:"isAdmin",id:"isAdmin",label:"Права администратора",modelValue:t(n),"onUpdate:modelValue":f[2]||(f[2]=_=>y(n)?n.value=_:null)},null,8,["modelValue"]),o(b,{type:"checkbox",name:"isModerator",id:"isModerator",label:"Права модератора",modelValue:t(l),"onUpdate:modelValue":f[3]||(f[3]=_=>y(l)?l.value=_:null)},null,8,["modelValue"])]),_:1},8,["submit-label"])]),_:1},8,["title"])]),_:1},512)])]),_:1})}}}),xe=V({__name:"index",setup(m){return L({title:"АГА. Список пользователей"}),(p,s)=>(h(),w(oe))}});export{xe as default};
