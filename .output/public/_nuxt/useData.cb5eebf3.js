import{u as v,a}from"./cookie.5691c368.js";import{B as m,r as h,u as n}from"./entry.676b6978.js";const w=m("data",{state:()=>{const t="/api/admin/data",i=h(void 0),e=h(void 0),s=h(void 0),r=h(void 0),o=h(void 0),d=h(void 0),u=h(void 0),c=h(void 0),f=h(void 0),p=h(void 0),l=v("ac_token");return{path:t,user:i,menu:e,news:s,users:r,regions:o,ownership:d,types:u,companies:c,articles:p,initiatives:f,accessToken:l}},actions:{async get(){const{data:t,error:i}=await a(`${this.path}`,{method:"get",headers:{Authorization:`Bearer ${this.accessToken}`}},"$5mpOZ1BxYP");if(i.value)return!1;const e=t.value;return this.menu=e.menu,this.user=e.user,this.news=e.news,this.users=e.users,this.regions=e.regions,this.ownership=e.ownership,this.types=e.types,this.articles=e.articles,this.companies=e.companies,this.initiatives=e.initiatives,!0},async updateUser(t){const{data:i,error:e}=await a(`${this.path}/user`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$zyv9jhBSUR");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateUsersData(s.user),s},updateUsersData(t){if(typeof this.users>"u"&&(this.users=[]),t){const i=this.users.findIndex(e=>e.id===t.id);i>=0?this.users[i]={...t}:this.users.push({...t})}this.users=this.users.sort((i,e)=>{const s=i.fio&&e.fio&&i.fio<e.fio?1:0,r=i.fio&&e.fio&&e.fio<i.fio?1:0,o=(i.isAdmin?100:0)+(i.isModerator?10:0)+s,d=(e.isAdmin?100:0)+(e.isModerator?10:0)+r;return o>d?-1:d>o?1:0})},async deleteUser(t){var r;if(t.id===((r=this.user)==null?void 0:r.id))return alert("Нельзя удалить активного пользователя"),!1;const{data:i,error:e}=await a(`${this.path}/user`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$ZILO77ut3w");if(e.value)return!1;const s=n(i.value);return s&&this.users&&(this.users=this.users.filter(o=>o.id!==s.id),alert(`Пользователь «${s.fio}» удалён`)),!0},async updateRegion(t){const{data:i,error:e}=await a(`${this.path}/region`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$2Crft2HsoT");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateRegionsData(s.region),s},updateRegionsData(t){if(typeof this.regions>"u"&&(this.regions=[]),t){const i=this.regions.findIndex(e=>e.id===t.id);i>=0?this.regions[i]={...t}:this.regions.push({...t})}this.regions=this.regions.sort((i,e)=>{const s=i.name<e.name?1:0,r=e.name<i.name?1:0,o=(i.isActive?10:0)+s,d=(e.isActive?10:0)+r;return o>d?-1:d>o?1:0})},async deleteRegion(t){var r;if(((r=this.regions)==null?void 0:r.length)===1)return alert("Нельзя удалить единственный регион"),!1;const{data:i,error:e}=await a(`${this.path}/region`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$xr3tVbS5Gh");return e.value?!1:(n(i.value)&&this.regions&&(this.regions=this.regions.filter(o=>o.id!==t.id),alert(`Регион «${t.name}» удалён`)),!0)},async updateOwnership(t){const{data:i,error:e}=await a(`${this.path}/ownership`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$LShci28Qsp");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateOwnershipData(s.ownership),s},updateOwnershipData(t){if(typeof this.ownership>"u"&&(this.ownership=[]),t){const i=this.ownership.findIndex(e=>e.id===t.id);i>=0?this.ownership[i]={...t}:this.ownership.push({...t})}this.ownership=this.ownership.sort((i,e)=>i.nameShort>e.nameShort?1:i.nameShort<e.nameShort?-1:0)},async deleteOwnership(t){const{data:i,error:e}=await a(`${this.path}/ownership`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$TvYigkPI4Y");return e.value?!1:(n(i.value)&&this.ownership&&(this.ownership=this.ownership.filter(r=>r.id!==t.id),alert(`Форма собственности «${t.nameFull}» удалена`)),!0)},getOwnershipById(t){if(!this.ownership)return;const i=this.ownership.findIndex(e=>e.id===t);if(i>=0)return this.ownership[i]},async updateInitiativeTypes(t){const{data:i,error:e}=await a(`${this.path}/types`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$BcKvYSPrCv");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateInitiativeTypesData(s.type),s},updateInitiativeTypesData(t){if(typeof this.types>"u"&&(this.types=[]),t){const i=this.types.findIndex(e=>e.id===t.id);i>=0?this.types[i]={...t}:this.types.push({...t})}this.types=this.types.sort((i,e)=>i.name>e.name?1:i.name<e.name?-1:0)},async deleteInitiativeTypes(t){const{data:i,error:e}=await a(`${this.path}/types`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$xVPw3baxqU");return e.value?!1:(n(i.value)&&this.types&&(this.types=this.types.filter(r=>r.id!==t.id),alert(`Тип инициативы «${t.name}» удалён`)),!0)},async updateNews(t){const{data:i,error:e}=await a(`${this.path}/news`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$BExUDNZ67R");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateNewsData(s.news),s},updateNewsData(t){if(typeof this.news>"u"&&(this.news=[]),t){const i=this.news.findIndex(e=>e.id===t.id);i>=0?this.news[i]={...t}:this.news=[{...t},...this.news]}this.news=this.news.sort((i,e)=>i.date>e.date?1:e.date>i.date?-1:0)},async deleteNews(t){const{data:i,error:e}=await a(`${this.path}/news`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$sKAuPDwUny");return e.value?!1:(n(i.value)&&this.news&&(this.news=this.news.filter(r=>r.id!==t.id),alert(`Новость «${t.title}» удалена`)),!0)},async updateCompany(t){const{data:i,error:e}=await a(`${this.path}/company`,{method:"post",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$dr7DH2zXrh");if(e.value)return!1;const s=n(i.value);return s.errors||this.updateCompanyData(s.company),s},updateCompanyData(t){if(typeof this.companies>"u"&&(this.companies=[]),t){const i=this.companies.findIndex(e=>e.id===t.id);i>=0?this.companies[i]={...t}:this.companies=[{...t},...this.companies]}this.companies=this.companies.sort((i,e)=>i.nameShort>e.nameShort?1:e.nameShort>i.nameShort?-1:0)},async deleteCompany(t){var r;if(((r=this.companies)==null?void 0:r.length)===1)return alert("Нельзя удалить единственную компанию"),!1;const{data:i,error:e}=await a(`${this.path}/company`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$UWig66ZbKh");return e.value?!1:(n(i.value)&&this.companies&&(this.companies=this.companies.filter(o=>o.id!==t.id),alert(`Компания «${t.nameFull}» удалена`)),!0)},async updateInitiative(t){const i={Authorization:`Bearer ${this.accessToken}`},{data:e,error:s}=await a(`${this.path}/initiative`,{method:"post",body:t,headers:i},"$ZHAKbtQBCe");if(s.value)return!1;const r=n(e.value);return r.errors||this.updateInitiativeData(r.initiative),r},updateInitiativeData(t){if(typeof this.initiatives>"u"&&(this.initiatives=[]),t){const i=this.initiatives.findIndex(e=>e.id===t.id);i>=0?this.initiatives[i]={...t}:this.initiatives=[{...t},...this.initiatives]}this.initiatives=this.initiatives.sort((i,e)=>i.name>e.name?1:e.name>i.name?-1:0)},async deleteInitiative(t){const{data:i,error:e}=await a(`${this.path}/initiative`,{method:"delete",body:t,headers:{Authorization:`Bearer ${this.accessToken}`}},"$pSMQqOn2So");if(e.value)return!1;const s=n(i.value);return s.status&&this.initiatives?(this.initiatives=this.initiatives.filter(r=>r.id!==t.id),alert(`Инициатива «${t.name}» удалена`)):s.errors?alert(s.errors):s.status||alert("Ошибка удаления инициативы"),!0},async approveCompany(t){const{data:i,error:e}=await a(`${this.path}/moderate_company`,{method:"post",body:{id:t,approved:!0},headers:{Authorization:`Bearer ${this.accessToken}`}},"$cfzNxVHeZh");return e.value?!1:(this.companies=i.value,!0)},async declineCompany(t,i){const{data:e,error:s}=await a(`${this.path}/moderate_company`,{method:"post",body:{id:t,declined:!0,reason:i},headers:{Authorization:`Bearer ${this.accessToken}`}},"$TjVltlOet8");return s.value?!1:(this.companies=e.value,!0)},async approveInitiative(t){const{data:i,error:e}=await a(`${this.path}/moderate_initiative`,{method:"post",body:{id:t,approved:!0},headers:{Authorization:`Bearer ${this.accessToken}`}},"$unFB6uBPNQ");return e.value?!1:(this.initiatives=i.value,!0)},async declineInitiative(t,i){const{data:e,error:s}=await a(`${this.path}/moderate_initiative`,{method:"post",body:{id:t,declined:!0,reason:i},headers:{Authorization:`Bearer ${this.accessToken}`}},"$UzvxcuEng1");return s.value?!1:(this.initiatives=e.value,!0)}}});export{w as u};
